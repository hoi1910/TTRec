TVTest TTRec Plugin ver.2.1

■概要
TVTestのEPG番組情報を使ってキーワード検索予約録画を行うプラグインです。
以下の機能があります。
・TVTest付属のEPG番組表から予約登録・変更
・タスクスケジューラを利用して予約時刻に自動復帰・TVTest起動
・TOT時刻補正で内部時計のずれに対応
・複数チューナでの使用に対応(限定的)

■動作環境
・Vista以降 (XP環境は自ビルドが必要)
・TVTest ver.0.7.16以降、or対応するTVH264
・必要ランタイム: 2015-2022 Visual C++ 再頒布可能パッケージ
  ・ビルド環境: Visual Studio Express 2017 for Windows Desktop

■以前のバージョン(ver.0.1～ver.2.0)からの移行
・TTRec.tvtpを置き換えてください。設定や予約はそのまま引き継げます
・ver.0.8以降ではクエリの検索キーワードのルールが微妙に変化しています。特につぎ
  の2点に注意してください:
  ・キーワードの全角と半角を区別しなくなった
  ・全角空白'　'はキーワードの一部になった(=区切りではなくなった)

■使い方
・TVTestのPluginsフォルダにTTRec.tvtp (x64版のTVTestはTTRec.tvtp_x64をリネーム)
  を入れ、TVTestを起動してください。プラグイン設定は{右クリックメニュー→設定→
  プラグイン→TTRec}から行います。最低限、この設定画面で"使用するBonDriver"を指
  定し、TVTestを再起動するか右クリックメニューからTTRecを有効化すれば、プラグイ
  ンは利用可能になります。ここで指定したBonDriverが次回以降の起動時に使われてい
  ればプラグインは自動で有効化します
・予約を行うときは{EPG番組表→右クリックメニュー}から予約登録・クエリ登録を選択
  してください
・各予約の録画終了後動作に「待機+～」を指定するとEPG取得ができます。この機能を使
  うときは{右クリックメニュー→設定→EPG/番組情報→待機時にEPG情報を取得する}を
  有効にしてください。また、TVTest ver.0.8.0以降の利用を強くお勧めします(詳しく
  は後述の「上級者向け」→「AppSuspendTimeout」を参照)
・TVTest ver.0.7.23以降とver.0.7.22以前(TVH264を含む)とでEPGファイル"EpgData"を
  共有していると番組表データが消えやすいようです。TVTestとTVH264を同じフォルダに
  置いている等の場合は{右クリックメニュー→設定→EPG/番組情報}でEPGファイル名を
  それぞれ別にしてください
・録画停止の確認をとることを勧めます(設定→録画→録画停止は確認をとる)
・タスクスケジューラへの登録に失敗する場合は、コントロールパネルからタスクスケジ
  ューラを開いて"TTRec_Reserves" "TTRec_ReservesN"というタスクを削除してみてくだ
  さい。とくにTVTestを管理者権限で開いたことがある場合は、管理者権限でタスクスケ
  ジューラを開いて確認してみてください

※複数チューナで使用したいときは後述「複数チューナでの使用」をよく読んでください

■プラグイン設定
[使用するBonDriver]
  指定したBonDriverがTVTest起動時に使われていればプラグインを有効化します。また
  、タスクスケジューラからの起動やチャンネル変更時に、このドライバを使います。
[補欠のBonDriver]
  未指定でも構いません。「使用するBonDriver」で指定したBonDriverに存在しないチャ
  ンネルに限りこのドライバを使います。両方のBonDriverは一体のものとして扱われ、
  このBonDriverがTVTest起動時に使われている場合にもプラグインを有効化します。例
  えば衛星用のBonDriverなどを想定していますが、当然ながら同時録画はできません。
[TOT時刻補正]
  指定の範囲内で放送波の時刻情報(Time Offset Table)を利用して時刻補正します。録
  画開始が大体ピッタリになります。PCの内部時計は変更しません。
  1～2分程度の内部時計のずれは打ち消して録画が欠けることなく補正できるので、利用
  をお勧めします。
[タスクスケジューラを使う]
  タスクスケジューラを利用してスリープからの復帰とTVTest起動を行います。復帰マー
  ジンを0にするとタスク登録を削除できます。
[連続する予約イベントを1ファイルにまとめる]
  チャンネル変更のいらない連続した番組は、そのまま録画を継続することで1つのファ
  イルにまとめます。
[イベントリレーする]
  録画中の番組にイベントリレー情報があれば、リレー元の番組終了約60秒前にリレー先
  に録画設定を引き継いだ予約を1つ作成します。TVTest ver.0.9.0以降で有効です。
[予約が始まるとき、再生オンにする]
  "見るだけ"もしくは通常録画予約のときTVTestが最小化されていれば最小化を解除し、
  再生オフならオンにします。
[録画前チャンネル変更・録画前スピンアップ]
  録画前にチャンネル変更や録画先HDDのスピンアップを行います。最小値は15秒で、そ
  れぞれ0にすると行いません(チャンネル変更はEPG情報更新のために推奨)。なお、
  TTRecは録画開始前に再度チャンネル設定を行うので、チャンネル変更後にユーザがチ
  ャンネルを操作しても大丈夫です(裏番組をギリギリまで見れます)。
[TVTest待機前に確認のダイアログを表示する]
  TVTestを待機状態にしてもよいか確認するカウントダウンのダイアログを表示します。
[プラグイン無効時にも番組表に予約の枠を描く]
  複数チューナでの使用時に、ほかのTTRecの予約を手軽に確認できます。枠を描くだけ
  で予約の変更や内容の確認はできません。
[バルーンで通知]
  デスクトップのタスクトレイ領域にバルーンチップを表示します。「警告」はTTRecに
  エラーが発生したとき、「録画イベント」は録画開始や終了時に通知します。
[TVTestのログに出力]
  上述のバルーンの内容をTVTestの設定→ログに出力します。
[デフォルト録画設定]
  予約登録でそれぞれデフォルトにしたときに適用される値を指定。開始・終了マージン
  はそれぞれ600秒まで、終了マージンはマイナスの値も指定可能です。変更は登録済み
  の予約にも適用されます("見るだけ"チェックボックスを除く)。
  「録画終了後」の動作については、つぎの予約がせまっているときには実行されません
  (詳しくは後述の「上級者向け」→「SuspendMargin」を参照)。また、番組移動などに
  より録画終了後動作を実行するとき、このデフォルト値が適用されます(詳しくは後述
  の「その他」→「録画とスリープについて」を参照)。「待機+～」を指定すると各動作
  の前にTVTestを待機状態にします(「上級者向け」→「AppSuspendTimeout」を参照)。

■予約設定(予約登録・予約変更)
※予約イベントの時刻はTVTest起動中に随時チェックします。直近の5番組は30秒ごと、
それ以降の番組は30秒ごとに1つずつ、TVTestのEPG情報と照合します。番組の消滅(たま
にあります)には対応していません(予約が残ったままになります)。
[録画時間]
  チェックをいれると時間指定予約になります。流動編成などでEPG情報が信用できない
  状況での利用などを想定しています。以下に注意してください:
  ・この予約に対する追従やイベントリレーは行われなくなります
  ・マージンや「開始時刻を遅らせる/早める」は指定時間に対して適用します
  ・番組表の枠は必ずしも正確に表示されません
  ・日付をまたいで開始時刻を変更するときは単純に目的の時刻を指定してください。時
    間的に近いほうへ日付も移動します
[イベント名]
  保存ファイル名の %event-name% がこの値に置き換わります。
  「イベント名:」の文字色がグレーになっているときは、EPG情報の番組タイトルが更新
  された場合に予約のイベント名を同期します。
[見るだけ]
  チェックをいれると録画動作のみを省略します。視聴忘れの防止に利用できます。
[開始時刻を遅らせる(分)]
予約イベントの開始時刻にこの値を足します。開始マージンは加算後の開始時刻に対して
適用されます。
[終了時刻を早める(分)]
予約イベントの終了時刻からこの値を引きます。終了マージンは減算後の終了時刻に対し
て適用されます。

■クエリ設定(クエリ登録)
※クエリからの予約作成はTVTestのEPG情報をもとに随時おこないます。基本的に60秒で
クエリチェックは一巡します(クエリ数が多い場合は2秒×{クエリ数}で一巡)。
[キーワード]
  ※ルールはTVTest ver.0.7.23やver.0.8.0の「番組の検索」のものと同じです。
  検索キーワードを半角空白' '(AND検索)または半角縦棒'|'(OR検索)で区切って複数指
  定できます。キーワードの先頭が半角ハイフン'-'の場合は除外検索になります。
  各キーワードの全角と半角は区別しません。また正規表現機能はありません。
  例:
    (番組タイトル1) = "月曜討論「どうなる退陣３条件」"
    (番組タイトル2) = "[再]月曜討論「どうなる退陣３条件」"
    "月曜討論 どうなる"      : (番組タイトル1),(番組タイトル2)にマッチ
    "月曜討論 -[再] どうなる": (番組タイトル1)にマッチ
    "月曜討論 [再] どうなる" : (番組タイトル2)にマッチ
[検索期間]
  この期間内に開始する番組を探します。例えば、"火"にチェックを入れ21時0分から6時
  間0分を指定すれば、火曜の21時0分から水曜の2時59分までに始まる番組を探します。
[ジャンル]
  指定したジャンルの番組を探します。
[イベント名を指定]
  指定しなければ番組タイトルを使用します。指定するとそのイベント名で予約を生成し
  ます。%num%に1以上を使用すると、予約生成のたびに値を増分し、イベント名に含まれ
  る%num%、%num2%がこの値に置き換わります(話数付加に便利)。
[無効にする]
  クエリを無効にすると新しい予約が生成されなくなります。

■優先度について
優先度は1から5までで、予約が重複した場合に数字の大きい予約を優先して録画します。
例えば、優先度3の予約を録画中に優先度4の予約が始まる場合、前者の録画は終了し、後
者の録画が始まります。また、いかなる優先度の予約でも、ユーザによる録画(ステータ
スバーの録画ボタンなどを使った録画)を中断することはありません。
"見るだけ"予約の優先度は、通常予約のあらゆる優先度よりも低くなります。

■TVTest起動オプションについて
プラグイン設定の"TVTest起動オプション"を指定すると、タスクスケジューラのTVTest起
動コマンドにこのオプションが追加されます。ドライバ指定オプション(/d foo.dll)はあ
らかじめ付加されているため指定する必要はありません。
例:
  "/mute"          消音にする
  "/min /nodshow"  最小化 + 起動時にDirectShowを初期化しない
  "/standby"       待機状態で起動する
この辺はTVTestの説明ファイルを読んでいろいろ組み合わせてみてください。

■その他
[EPG番組表の装飾の意味]
  予約登録すると、その番組は緑色の線で囲われます。"見るだけ"予約の場合は破線にな
  ります。また、つぎに録画される番組はオレンジで囲われ、さらに現在録画中であれば
  赤色になります。予約が被っていたりして録画時間が短くなる予定のときは、オレンジ
  で囲われる部分が小さくなるので、大体の目安にもなります。
[録画とスリープについて]
  ここでは、スタンバイと休止状態をまとめてスリープと表現します。また、録画開始の
  数分前(具体的には{SuspendMargin+ResumeMargin}分前)から録画終了までを"待機+録画
  期間"と表現します。
  Vista以降のWindowsは、スリープから復帰後ユーザ操作がなければ、デフォルトで2分
  後に再度スリープします。TTRecは"待機+録画期間"にこれを阻止します。したがって、
  Vista以降は録画終了後動作を「何もしない」または「TVTestを終了」でも、自動復帰
  →スリープの運用ができます。
  さらに、TTRec ver.0.5以降は"待機+録画期間"にユーザによるスリープ(スタートメニ
  ューからスリープボタンを押すなど)も阻止します。このとき、Vista以降はAwayMode
  (詳細は検索してください)になります。
  TTRec ver.0.7以降は、"待機+録画期間"に入った後に番組移動などで"待機+録画期間"
  を出たとき、デフォルト録画設定の録画終了後動作を実行します。

■仕様(という名の不具合)
・モニタの電源が切れている状態では、DirectShow絡みのエラーでTVTestが正常に起動し
  ない環境があるようです。恐らくレンダラによるエラーなので、レンダラをかえるか、
  起動オプションに/nodshowを指定して回避してください
・クエリ登録件数は100件までです。予約件数は無制限ですが、一覧は直近100件までしか
  表示されません
・番組延長や移動に対応していますが、番組消滅には対応していません
・野球など長さ不明で延長しがちな番組を終了マージンや「終了時刻を早める」で削りす
  ぎ(およそ2分以上)ないようにしてください。延長前に録画終了するおそれがあります

■上級者向け
[設定ファイル"TTRec.ini"の隠しキー]
※それぞれ必要がなければデフォルトのままにしておいてください
SuspendMargin
    次の予約開始まで{SuspendMargin+ResumeMargin}分なければ録画終了後動作を実行し
    ません。意味的には、SuspendMarginは録画終了からシステムの休止までにかかる時
    間、ResumeMarginは復帰から録画開始までにかかる時間、それぞれに余裕をもたせた
    ものです。
SuspendWait
    TVTestを終了後、何秒後にPCをスリープにするか(最大120秒)
    # 一部のBonDriverには、TVTest終了後もプロセスが数秒間生きたままになるものが
    # あります。このようなBonDriverにチューナを解放する時間をあたえ、安全にスリ
    # ープさせる場合などに便利です。
ExecWait
    PCがスリープから復帰後、何秒後にTVTestを起動するか(最大120秒)
ForceSuspend
    強制的にスリープする[=1]かどうか(SetSuspendStateの2番目の引数)
ShowTrayWhileAppSuspend
    TVTestを待機状態にしているときタスクトレイにアイコンを表示する[=1]かどうか
    ver.0.9.0以降は標準のトレイアイコンが出るためデフォルトで[=0]です。
AppSuspendTimeout
    「録画終了後動作」を「待機+～」にしているときに最大何分間までTVTestを待機状
    態にしておくかを指定します。TVTestでの番組表取得にかかる時間にいくらか余裕を
    もたせた値を指定すると良いです(デフォルトは20分)。また次の予約開始まで
    {AppSuspendTimeout+SuspendMargin+ResumeMargin}分なければ待機状態にしません。
    実際の取得完了はプラグインで自動判定しますが、ver.0.7.23以前のTVTestでは判定
    にやや時間がかかります(完了時にBonDriverが解放されないため)。番組表取得の精
    度も改良されている(蓄積判定が実装されたため取得漏れが起きない)ようなので、
    ver.0.8.0以降の利用をお勧めします。
AppSuspendDuration
    このキーは廃止しました
ExecOnStartRec/ExecOnEndRec
    予約開始/終了時にコマンドを実行できます。添付の"TTRec_Exec.bat"を参照してく
    ださい。
*Color
    EPG番組表のイベントを囲う枠の色
EventNameTr
    保存ファイル名の%event-name%を展開するときに文字を置換する(最長511文字)
    # 置換する文字のリストを/で区切って指定します。設定例(全角→半角):
    # EventNameTr=/０１２３４５６７８９ＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚ　！＃＄％＆’（）＋，－．；＝＠［］＾＿‘｛｝￣/0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz !#$%&'()+,-.;=@[]^_`{}~/
    # ※ver.0.7.23以前のTVTestでは % を含む録画ファイル名に不具合があるので注意
    # してください(TVTestの更新履歴参照)
EventNameRm
    保存ファイル名の%event-name%を展開するときに文字列を削除する(最長511文字)
    # 文字列を/で区切って指定します。EventNameTr適用後に処理されます。設定例:
    # EventNameRm=/[字]/[解]/[デ]/[双]/[再]/[二]/[新]/[終]/[SS]/[多]/
StatusItemPrefix
    ステータスバー項目の文字列
    # デフォルトで"TTRec <Standby>"のようになっている"TTRec "の部分を指定文字列
    # でカスタマイズできます

■複数チューナでの使用
プラグインファイル名"TTRec.tvtp"を適当にリネーム("TTRec1.tvtp"と"TTRec2.tvtp"な
ど)してPluginsフォルダに置き、プラグイン設定の"使用するBonDriver"を各々選択して
ください。プラグインが有効なTVTestが他に起動していれば、録画終了後にスリープは行
いません(スリープ確認のダイアログは出ます)。
複数のTVTestで使用することもできますが、プラグインファイル名は重複しないよう必ず
リネームしてください(タスクスケジューラにこのファイル名で登録するため)。
[注意点など]
・プラグイン同士での予約の融通(空いてるチューナを判断して割り振るなど)といったレ
  ベルの高いことはできません
・EPG番組表の「番組の左ダブルクリック動作」には1つのプラグインのコマンドしか割り
  当てることができませんが、TVTest ver.0.10.0以降はいずれか1つのコマンド割り当て
  ですべてのTTRecが同じ動作をします。これ以前のver.0.8.0以降のTVTestでは、裏技的
  ですが起動オプション/inikeyを駆使して対処してください。指定例:
    /inikey [ProgramGuide]ProgramLDoubleClick=TTRec2.tvtp:ReserveDefault
・※以下、プラグイン設定の"使用するBonDriver"で設定した全てのBonDriverを「TTRec
  制御下のBonDriver」と表現します。「使い方」で書いたように、TTRecは起動時に、そ
  のTVTestで録画対象となるBonDriverを決定します。一旦録画対象としたBonDriverを変
  更することはありません。したがってTVTest起動中に他の「TTRec制御下のBonDriver」
  に切り替えないようにしてください。切り替えて使用中にそのBonDriverの予約が重な
  ると、録画に失敗します

■予約ファイルのフォーマット(開発者向け)
文字コード: ByteOrderMarkつきUTF16-LE
セパレータ: TAB / CR+LF

{プラグインファイル名}_Reserves.txt
  NetworkID
  TransportStreamID
  ServiceID
  EventID
  番組開始時刻 yyyy-MM-ddTHH:mm:ss
  番組長 HH:mm:ss
    ※EIT[p/f]を使って番組開始時刻や番組長を更新したとき接尾に!がつく(HH:mm:ss!)
    ※予約が無効のとき接尾に#がつく(HH:mm:ss# または HH:mm:ss!#)
    ※時間指定予約のとき接尾に$がつく(HH:mm:ss$ または HH:mm:ss#$)
  イベント名 最長127文字 ※EPG情報そのままのときは接頭にDC1(0x11)制御文字がつく
  開始マージン -1=デフォルト,0～600
  終了マージン -1=デフォルト,0～600,601～1200=負マージン(600からこの値を引く)
  優先度 0=デフォルト,1～5=低～高,-6=見るだけデフォルト,-5～-1=見るだけ低～高
  録画終了後 0=デフォルト,1～8=何もしない～待機+休止状態
  保存先フォルダ *=デフォルト 最長259文字
  保存ファイル名 *=デフォルト 最長259文字
  開始時刻を遅らせる(秒)
  終了時刻を早める(秒)

{プラグインファイル名}_Queries.txt
  有効フラグ 0=無効,1=有効
  NetworkID
  TransportStreamID
  ServiceID
  ジャンル 上位8bit=大分類(FF=すべて,0F=その他,00～0E),下位8bit=中分類(同様)
  曜日フラグ .=オフ,T=オン
  検索開始時刻 HH:mm:ss
  検索長 HH:mm:ss
  %num%
  キーワード 最長127文字 ※大小文字区別しないときは接頭にDC1(0x11)制御文字がつく
  イベント名 *=未指定 最長127文字
  (以下_Reserves.txtと同様)

■ソースについて
当プラグインはEDCBSupportプラグインをベースにしつつTVTest本体からいくらかコード
を流用しています(感謝!)。流用元はソースコメントに記述してあります。その他の部分
は勝手に改変・利用してもらって構いません。

■更新履歴
ver.2.1 (2022-10-26)
・補欠のBonDriverを指定できるようにした
・時間指定予約に対応
ver.2.0 (2022-09-19)
・TVTestPlugin.hを更新
・ダイアログのダークテーマ対応など
・プラグイン無効時にも番組表に予約の枠を描けるようにした
ver.1.9 (2016-12-22)
・TVTestPlugin.hを更新
・時間計算を厳密にEPG日時(UTC+9)で行うようにした
ver.1.8 (2016-07-30)
・TVTestPlugin.hを更新、ver.0.9.0以降で以下の機能を有効化:
  ・ログを出力するとき種類を指定
  ・TTRecの動作状態をステータスバーに表示できる機能
・高DPI時にダイアログの文字が欠けないよう調整
・VisualStudio2015用のプロジェクトファイルを追加
  ・NO_CRT(CRT非依存)ではない
ver.1.7 (2015-03-29)
・チューニング空間の分離が特殊なBonDriverに対応
  ・pttimerスレの http://peace.2ch.net/test/read.cgi/avi/1413760076/366
・ver.0.9.0以降で提供される予定のイベントリレー情報に対応
  ・EDCBのソースコードがすごく参考になった
・ver.0.9.0以降はShowTrayWhileAppSuspendのデフォルトを[=0]に変更
・タスクトレイアイコンがExplorer再起動時に表示されることがあるのを修正
・ログを出力するとき種類を指定するようにした
  ・ver.0.9.0以降のみ。TVTestPlugin.hとTTRec.cpp14行目の更新が必要
ver.1.6 (2014-12-16)
・EPG情報の番組タイトルが更新された場合に予約のイベント名を同期するようにした
  ・イベント名を手動変更していない場合に限る
  ・同期対象の予約は予約設定の「イベント名:」の文字色がグレーになる
・12時間以上の番組追従を行わないようにした
  ・ごく稀なケースとしてEventIDが巡回したときに追従してしまう可能性があるため
・予約開始/終了コマンド実行時にTVTest本体の環境変数を汚さないようにした
・より重要なバルーン通知が長く表示されるように調整
・隠しキーShowDialogOnAppSuspendをプラグイン設定ダイアログに移動
・「TOT時刻補正」の初期設定値を±5分に変更
・TTRecの動作状態をステータスバーに表示できる機能をソースコードに追加
  ・TVTest ver.0.9.0以降のみ。TVTestPlugin.hとTTRec.cpp14行目の更新が必要
・若干のコード整理
ver.1.5 (2014-09-19)
・Vista以降の環境についてもクエリの検索キーワードのルールをTVTest本体の「番組の
  検索」のものに完全に合わせた
  ・おもに半角カナの扱いがver.1.4と微妙に違う
・設定キーEventNameTr、EventNameRmを追加
・バルーン通知「EPG取得が完了(または中断)しました。」を追加
・同ファイル名で同時に録画開始すると稀に「ファイルが開けません。」となるのを修正
・その他コード整理とTVTest本体からの流用部分のアップデート
・「複数チューナでの使用」についての説明を増やした
ver.1.4 (2014-05-15)
・TVTest待機状態や/epgonlyから復帰しての録画に対応
・タスクスケジューラからTVTestを起動するまでの間に万一、手動によるスリープが行わ
  れた場合、AwayModeに移行させるようにした
・SetThreadExecutionStateを呼ぶとき、前回の状態を考慮するようにした
  ・つまり本体や他プラグインに影響しないよう行儀よくした
ver.1.3 (2014-03-28)
・スリープ解除抑止で2重にTVTestを起動させる可能性があるのを修正
ver.1.2 (2014-03-26)
・予約を無効にできるようにした
・見るだけのときスリープ解除を抑止できるようにした
ver.1.1 (2013-09-30)
・EIT[p/f]をちゃんと見るようにした
  ・番組延長にちょっとだけ強くなるはず
・TVTest終了後スリープさせるまでの間に外部要因(手動など)によるスリープが行われた
  場合、2重にスリープがかからないよう考慮
・予約ファイル書き込み失敗への耐性を強化
・予約ファイルのフォーマットについて説明を書いた
・予約ファイルを再読み込みさせるウィンドウメッセージを追加
  ・外部からの予約書き込みを想定してインフラだけ整備
ver.1.0 (2013-06-29)
・TVTestの待機状態を利用したEPG取得機能を整えた
  ・待機状態にしたときに独自にタスクトレイにアイコンを出すようにした
  ・EPG取得の完了を自動判定して速やかに復帰するようにした
  ・番組表に'T'マークを表示
・Vista以降はタスク登録にタスクスケジューラ2.0を使うようにした
  ・起動失敗時にリトライするのでちょっとだけ強い(はず)
・メモリ解放もれ修正
  ・ダイアログ開くごとに1個のリークなので旧バージョンでも特に深刻ではない
ver.0.9 (2013-03-23)
・システム高負荷時、タスク登録に長い時間がかかって録画失敗する可能性を修正
・録画終了後動作で常駐モード(設定→一般→常駐する)でもTVTestを終了するようにした
  ・常駐モードはほとんど使ったことがないのでTTRecで運用できるかは不明
・録画終了後動作でTVTestを待機状態にできるようにした
  ・EPG取得に使える。実験的
ver.0.8 (2012-10-07)
・クエリの検索キーワードのルールを本体の「番組の検索」のものに合わせた
  ・というか本体の検索ルーチンそのもの
・EPG番組表の「番組の左ダブルクリック動作」に予約設定などを指定できるようにした
・「予約が始まるとき、再生オンにする」を通常録画予約でも使用できるようにした
・予約開始・終了時にコマンドを実行できるようにした(要iniファイル修正)
・本体プログラムのファイル名が"TVTest.exe""TVH264.exe"以外でも大丈夫なようにした
・ジャンルから"モータースポーツ"が抜けていたのを修正
・その他コード整理と微修正
ver.0.7 (2012-02-25)
・予約のイベント名や保存ファイル名などを合計した文字数を非常に長く設定した場合に
  オーバーランする可能性があるのを修正
・録画終了後動作の確認ダイアログが全画面表示時に隠れてしまう可能性があるのを修正
・録画時間の前後を削れるようにした
・予約設定ダイアログの録画時間を秒まで表示するようにした
・バルーン通知の内容をTVTestのログにも出せるようにした
・番組移動が発生したときなどに必要ならば録画終了後動作を実行するようにした
ver.0.6 (2012-01-06)
・"見るだけ"予約をデフォルト設定できるようにした
・バルーン通知機能をつけた
・予約ファイルアクセスのエラー耐性強化
・タスクスケジューラ登録のエラーチェック厳密化
・録画中に終了後動作を変更しても適用されなかったのを修正
・コードを少し整理
ver.0.5 (2011-09-25)
・改編期にあわせて微調整
  ・タスクスケジューラへの登録処理の待ち時間が結構長いので、別スレッドにした
    ・予約登録のレスポンスが向上
  ・録画中はユーザ操作によるスリープ移行を阻止するようにした
  ・"TTRec.tvtp"以外にリネームした場合、タイトルバーにファイル名を表示して、区別
    できるようにした
  ・x64版も付けてみた
  ・その他微修正
ver.0.4 (2011-07-24)
・除外検索を追加した
・動作に関する細かい修正
  ・予約が連続している場合に後続の録画開始前のHDDスピンアップが行われない場合が
    あったのを修正
  ・"見るだけ"予約開始時に再生オフであればオンになるようにした
  ・TOTセクションの取得部分をより厳密にした
ver.0.3 (2011-07-05)
・スレッドの書き込みをもとに2点追加してみた
  ・終了マージンに負の値を設定できるようにした
  ・録画無しで予約するオプションを追加した #たしかにこれ便利かも
ver.0.2 (2011-07-03)
・プラグインが有効なTVTestが他に起動していればスリープしないようにした
・タスクスケジューラからの起動時、すでに同名のプラグインが起動していないか確認す
  るようにした(=複数起動禁止が不要に)
・録画関連の変更は無し
ver.0.1 (2011-06-30)
・初版
